<!DOCTYPE html>
<html lang="en">
<head>
	<title>Battle</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
	
</head>
<body>
	<div class="limiter">
		<div class="container-quickMenu">
			<div class="wrap-quickMenu">
				<ul>
					<li><a href="/Trelo/index.html">Home</a></li>
					<li><a href="/Batalha/index.html">Batalha</a></li>
					<li><a href="">Estatísticas</a></li>
					<li><a href="*">Sair</a></li>
				</ul>

			</div>
		</div>
		<div class="container-battle">
			<div class="battle-field" id="currentWeatherImage">
				<div class="battle-field__player">
					<div class="battle-field__player__name">
						<h1>Player 1</h1>
					</div>
					<div class="battle-field__player__image">
						<img src="images/PersTeste.png" alt="Player 1">
					</div>
				</div>
				<div class="battle-field__enemy">
					<div class="battle-field__enemy__name">
						<h1>Player 2</h1>
					</div>
					<div class="battle-field__enemy__image">
						<img src="images/PersTeste.png" alt="Player 1">
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<script>
	//Weather API
	//key 2451a7026a64d2b7d52cad55f3e33a1b
	// const cityInput = document.querySelector(".city-input");
	// const searchButton = document.querySelector(".search-btn");
	//const locationButton = document.querySelector(".location-btn");
	const API_KEY = "2451a7026a64d2b7d52cad55f3e33a1b"; // API key for OpenWeatherMap API
	const currentWeatherImage = document.getElementById("currentWeatherImage");

	const getWeatherDetails = (cityName, latitude, longitude) => {
		const WEATHER_API_URL = `https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${API_KEY}`;

		// Get weather forecast from OpenWeatherMap API
		fetch(WEATHER_API_URL).then(response => response.json()).then(data => {
			// Get the current weather details
			var weather = data.list[0].weather[0].main;
			// currentWeatherImage.src = "images/Clouds.jpg";
			console.log(weather);
			if(weather === "Clear")
				currentWeatherImage.style.backgroundImage = "url('images/Clear.jpg')";
			else if(weather === "Snow")
				currentWeatherImage.style.backgroundImage = "url('images/Snow.jpg')";
			else if(weather === ("Thunderstorm" || "Drizzle" || "Rain"))
				currentWeatherImage.style.backgroundImage = "url('images/Thunderstorm.jpg')";
			else if(weather === ("Clouds" || "Mist" || "Smoke" || "Haze" || "Dust" || "Fog" || "Sand" || "Ash" || "Squall" || "Tornado"))
				currentWeatherImage.style.backgroundImage = "url('images/Clouds.jpg')";
			// currentWeatherImage.src = "images/" + weather + ".jpg";
		}).catch(() => {
			alert("An error occurred while fetching the weather forecast! Please allow location access and refresh the page.");
		});
	}

	// Não vai usar
	const getCityCoordinates = () => {
		const cityName = cityInput.value.trim();
		if (cityName === "") return;
		const API_URL = `https://api.openweathermap.org/geo/1.0/direct?q=${cityName}&limit=1&appid=${API_KEY}`;

		// Get entered city coordinates (latitude, longitude, and name) from the API response
		fetch(API_URL).then(response => response.json()).then(data => {
			if (!data.length) return alert(`No coordinates found for ${cityName}`);
			const { lat, lon, name } = data[0];
			getWeatherDetails(name, lat, lon);
		}).catch(() => {
			alert("An error occurred while fetching the coordinates!");
		});
	}

	const getUserCoordinates = () => {
		navigator.geolocation.getCurrentPosition(
				position => {
					const { latitude, longitude } = position.coords; // Get coordinates of user location
					// Get city name from coordinates using reverse geocoding API
					const API_URL = `https://api.openweathermap.org/geo/1.0/reverse?lat=${latitude}&lon=${longitude}&limit=1&appid=${API_KEY}`;
					fetch(API_URL).then(response => response.json()).then(data => {
						const { name } = data[0];
						getWeatherDetails(name, latitude, longitude);
					}).catch(() => {
						alert("An error occurred while fetching the city name!");
					});
				},
				error => { // Show alert if user denied the location permission
					if (error.code === error.PERMISSION_DENIED) {
						alert("Geolocation request denied. Please allow for background ambiance.");
					} else {
						alert("Geolocation request error. Please reset location permission.");
					}
				});
	}

	getUserCoordinates();
	//locationButton.addEventListener("click", getUserCoordinates);
	//searchButton.addEventListener("click", getCityCoordinates);
	//cityInput.addEventListener("keyup", e => e.key === "Enter" && getCityCoordinates());
</script>
